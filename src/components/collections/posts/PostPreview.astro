---
import type { ImageMetadata } from "astro";
import type { HTMLAttributes } from "astro/types";
import type { RenderedContent } from "astro:content";
import { Picture } from "astro:assets";
import { collectionSettings } from "~/site.config";
import slugify from "slugify";
import truncate from "truncate-html";
import TextBtn from "~/components/ui/buttons/TextBtn.astro";
import Date from "~/components/ui/Date.astro";

interface Props extends HTMLAttributes<"li"> {
  category: string;
  content?: RenderedContent;
  date: Date;
  heading: string;
  href: string;
  image?: {
    alt: string | null;
    src: ImageMetadata;
  };
}

const { category, content, date, heading, href, image }: Props = Astro.props;
---

<li class="flex flex-col gap-2">
  {
    image && (
      <Picture
        src={image.src}
        widths={[480, 960]}
        sizes={`(max-width: 640px) 480px`}
        inferSize
        formats={["webp"]}
        loading="lazy"
        class="aspect-video object-cover"
        alt={image.alt ?? ""}
      />
    )
  }

  <h3>{heading}</h3>

  <div class="flex items-baseline gap-1 text-sm font-medium">
    <Date class="self-center" date={date} />
    <span>|</span>
    <TextBtn
      href={`${Astro.site}${collectionSettings.permalink_posts_category}/${slugify(category, { lower: true })}`}
      label={category}
    />
  </div>

  <article
    class="prose prose-primary max-w-none"
    set:html={content
      ? truncate(content.html, { length: 200, byWords: true })
      : "<p>Content not found.</p>"}
  />

  <TextBtn
    class="mt-2 -ml-1 font-semibold"
    href={href}
    icon="material-symbols:arrow-right-alt"
    iconAnimate={true}
    label="Continue reading"
  />
</li>
