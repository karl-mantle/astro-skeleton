---
import { Icon } from "astro-icon/components";

const iconSize = 24;
---

<li>
  <button
    id="theme-toggle-btn"
    class="hover:bg-primary-200 dark:hover:bg-primary-800 focus-visible:bg-focus-visible cursor-pointer border-b-2 border-transparent p-2 transition-colors duration-300 focus-visible:border-black focus-visible:text-black"
    type="button"
    aria-label="toggle colour mode"
    aria-pressed="false"
  >
    <Icon
      name="material-symbols:sunny-outline"
      height={iconSize}
      width={iconSize}
      class="hidden dark:block"
    />
    <Icon
      name="material-symbols:moon-stars-outline"
      height={iconSize}
      width={iconSize}
      class="block dark:hidden"
    />
  </button>
</li>

<script>
  function initTheme() {
    const toggleButton = document.getElementById("theme-toggle-btn");
    if (!toggleButton || toggleButton.dataset.initialized === "true") return;

    toggleButton.dataset.initialized = "true";

    /* determine initial theme */
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = savedTheme === "dark" || (!savedTheme && prefersDark) ? "dark" : "light";

    document.documentElement.classList.toggle("dark", theme === "dark");
    localStorage.setItem("theme", theme);

    /* toggle click handler */
    const handleToggleClick = () => {
      const isDark = document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    toggleButton.addEventListener("click", handleToggleClick);
  }

  document.addEventListener("astro:page-load", initTheme);
</script>
